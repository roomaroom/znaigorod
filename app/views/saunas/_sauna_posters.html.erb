<% @presenter.organizations.each do |organization| %>
  <% cache "sauna_#{organization.id}", expires_at: 10.minutes do %>
    <li class='sauna_item <%= cycle('item_1', 'item_2', :name => 'sauna_item') %>'>
      <div class='info'>
        <div class='image'>
          <% if organization.sauna.sms_claimable? %>
            <div class='sms_claimable'>
              <%= organization.sauna.reservation_title %>
            </div>
            <%= link_to organization.sauna.reservation_title,
              send("new_sauna_sms_claim_path", organization.sauna), :class => :sms_claim_link %>
          <% end %>
          <% if organization.sauna.sauna_halls.first.images.any? %>
            <%= link_to image_tag(resized_image_url(organization.sauna.sauna_halls.first.images.first.file_url, 178, 178), :size => '178x178', :alt => organization.title.text_gilensize),organization_path(organization) %>
            <div class="logo_image">
              <% if organization.logotype_url? %>
                <%= image_tag(resized_image_url(organization.logotype_url, 50, 50), :size => '50x50', :alt => organization.title.text_gilensize) %>
              <% else %>
                <span class='stub_poster <%= organization.priority_suborganization_kind %>'></span>
              <% end %>
            </div>
          <% else %>
            <% if organization.logotype_url? %>
              <%= link_to image_tag(resized_image_url(organization.logotype_url, 178, 178), :size => '178x178', :alt => organization.title.text_gilensize),organization_path(organization) %>
            <% else %>
              <span class='stub_poster <%= organization.priority_suborganization_kind %>'></span>
            <% end %>
          <% end %>


          <%= link_to organization_path(organization), class: :details do %>
            <span class='first_line'>
              <span class='to_go'><%= organization.visits.count %></span>
              <span class='wait_invite'>0</span>
              <span class='comments'><%= organization.comments.count %></span>
            </span>
            <span class='second_line'>
              <span class='likes'><%= organization.likes_count %></span>
              <span class='visits'><%= organization.page_visits.count %></span>
            </span>
          <% end %>
        </div>

        <div class='title'><%= organization.truncated_title_link %> </div>

        <div class='address'>
          <%= organization.truncated_address_link.present? ? organization.truncated_address_link : "&nbsp;".html_safe %>
        </div>

        <div class='phone'>
          <%= organization.decorated_phones %>
        </div>
      </div>

      <ul class='sauna_halls need_scrolling'>
        <% organization.sauna.ordered_sauna_halls.each do |sauna_hall| %>
          <li<%= ' class=non_suitable' unless @presenter.sauna_hall_ids.include?(sauna_hall.id) %>>
            <%= render :partial => 'sauna_hall', :locals => { :sauna_hall => sauna_hall } %>
          </li>
        <% end %>
      </ul>
    </li>
  <% end %>
<% end %>

<% if @presenter.last_page? %>
  <% @presenter.organization_for_saunas_without_halls.each_with_index do |organization, index| %>
    <li class='sauna_short_item <%= cycle('item_1', 'item_2', 'item_3', 'item_4', :name => 'sauna_short_item') %><%= ' clear_left' if index.zero? %>'>
      <div class='info'>
        <div class='title'><%= organization.truncated_title_link %> </div>
        <hr />
        <%= content_tag :div, organization.truncated_address_link, :class => :address if organization.truncated_address_link.present? %>
        <div class='phone'>
          <%= organization.decorated_phones %>
        </div>
      </div>
    </li>
  <% end %>
<% end %>

<% unless @presenter.last_page? %>
  <li class="item pagination">
    <%= link_to_next_page @presenter.paginated_collection, "Еще организации (#{@presenter.current_count})", :remote => true, :class => 'js-next-page btn btn-block btn-grey btn-lg', :params => params %>
  </li>
<% end %>
